{% extends "layouts/base.html" %}

{% block title %}Detalle de Orden{% endblock %}

{% block content %}

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible" role="alert" style="display: none;">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<div class="row">
  <div class="col-md-10 offset-md-1">
    <div class="card">
      <div class="card-header card-header-primary">
        <h4 class="card-title">
          Orden {{ orden.codigo_oc }} - {{ orden.cliente.nombre_cliente }}
        </h4>
        <p class="card-category">Fecha: {{ orden.fecha_solicitud }}</p>
      </div>
      <div class="card-body">
        <table class="table">
          <thead>
            <tr>
              <th>Referencia</th>
              <th>Cantidad Solicitada</th>
              <th>Despachado</th>
              <th>Pendiente</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for producto in orden.productos.all %}
            <tr>
              <td>{{ producto.producto.referencia }}</td>
              <td>{{ producto.cantidad }}</td>
              <td>{{ producto.despachado }}</td>
              <td>{{ producto.pendiente }}</td>
              <td>
                {% if producto.pendiente > 0 %}
                <a href="{% url 'registrar_despacho' producto.id %}"
                   class="btn btn-sm btn-primary">
                   Registrar Despacho
                </a>
                {% else %}
                <span class="badge badge-secondary">Completado</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5">No hay productos en esta orden.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <!-- BotÃ³n volver -->
      <div class="mb-3 text-start" style="margin-left: 20px; margin-bottom: 20px;">
          <a href="{% url 'buscar_orden' %}" class="btn btn-secondary">
              Volver
          </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
